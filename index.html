<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ ë°˜ ë””ì§€í„¸ íƒí—˜ì¼ê¸°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, sans-serif;
            background: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #6B73FF, #5D5FEF);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .subtitle {
            background: white;
            color: #5D5FEF;
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
            margin-top: 10px;
            font-weight: 600;
        }
        
        .content {
            padding: 20px;
        }
        
        /* ì„¹ì…˜ ì¹´ë“œ ê°œì„  */
        .section-card {
            background: white;
            border: 2px solid #e8ecff;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-title {
            color: #5D5FEF;
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        /* ì´ë¦„ ì…ë ¥ */
        .name-section {
            text-align: center;
            background: linear-gradient(135deg, #f8f9ff, #fff);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .name-input {
            padding: 10px 20px;
            border: 2px solid #6B73FF;
            border-radius: 25px;
            font-size: 1.1em;
            width: 200px;
            margin: 10px;
        }
        
        /* ë‹¤ì¤‘ì„ íƒ ê°€ëŠ¥í•œ í™œë™ ì²´í¬ */
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .activity-item {
            background: #f8f9ff;
            border: 2px solid #e8ecff;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .activity-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .activity-item.checked {
            background: linear-gradient(135deg, #6B73FF, #5D5FEF);
            color: white;
            transform: scale(0.95);
        }
        
        .activity-item label {
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* ì‹œê°„ ê¸°ë¡ ìŠ¬ë¼ì´ë” */
        .time-tracker {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .time-input {
            width: 100%;
            margin: 10px 0;
        }
        
        .time-display {
            text-align: center;
            font-size: 1.5em;
            color: #5D5FEF;
            font-weight: bold;
            margin: 10px 0;
        }
        
        /* ê°œë°©í˜• ì§ˆë¬¸ í…ìŠ¤íŠ¸ ì˜ì—­ */
        .text-area-wrapper {
            margin: 20px 0;
        }
        
        .text-area-label {
            display: block;
            color: #5D5FEF;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .text-area {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #e8ecff;
            border-radius: 12px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .text-area:focus {
            outline: none;
            border-color: #6B73FF;
            background: #f8f9ff;
        }
        
        .writing-helper {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .helper-btn {
            background: white;
            border: 1px solid #e8ecff;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .helper-btn:hover {
            background: #6B73FF;
            color: white;
        }
        
        /* ê°ì • ì´ëª¨ì§€ ì„ íƒ */
        .emotion-selector {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 12px;
            margin: 15px 0;
        }
        
        .emotion-btn {
            font-size: 2em;
            background: white;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .emotion-btn:hover {
            transform: scale(1.2);
        }
        
        .emotion-btn.selected {
            border-color: #6B73FF;
            background: linear-gradient(135deg, #f8f9ff, #fff);
        }
        
        /* ì¹œêµ¬ì™€ ê³µìœ  ì„¹ì…˜ */
        .share-section {
            background: linear-gradient(135deg, #fff8f0, #fff);
            border: 2px solid #ffe8d0;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .friend-share {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 15px 0;
        }
        
        .friend-share input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 2px solid #ffe8d0;
            border-radius: 10px;
            font-size: 1em;
        }
        
        .share-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* ì„±ì°° ì¹´ë“œ */
        .reflection-card {
            background: linear-gradient(135deg, #f0fffe, #fff);
            border: 2px solid #4ECDC4;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .reflection-title {
            color: #4ECDC4;
            font-size: 1.3em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .reflection-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .reflection-item {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9ff;
            border-left: 4px solid #4ECDC4;
            border-radius: 8px;
        }
        
        .reflection-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .reflection-text {
            color: #333;
            font-size: 1.05em;
            line-height: 1.5;
        }
        
        /* ì§„í–‰ë„ í‘œì‹œ */
        .progress-bar {
            background: #e8ecff;
            border-radius: 50px;
            height: 20px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #6B73FF, #4ECDC4);
            height: 100%;
            border-radius: 50px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }
        
        .primary-btn {
            background: linear-gradient(135deg, #6B73FF, #5D5FEF);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.05em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(107,115,255,0.3);
        }
        
        .primary-btn:hover {
            transform: translateY(-2px);
        }
        
        .secondary-btn {
            background: white;
            color: #6B73FF;
            border: 2px solid #6B73FF;
            padding: 12px 30px;
            font-size: 1.05em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* ë§í’ì„  íŒíŠ¸ */
        .hint-bubble {
            background: #fffbf0;
            border: 2px solid #ffd93d;
            border-radius: 15px;
            padding: 10px 15px;
            margin: 10px 0;
            position: relative;
            font-size: 0.95em;
            color: #666;
        }
        
        .hint-bubble::before {
            content: 'ğŸ’¡';
            position: absolute;
            left: -5px;
            top: -5px;
            font-size: 1.2em;
        }
        
        /* ì¹œêµ¬ ì½”ë©˜íŠ¸ */
        .friend-comments {
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .comment {
            background: white;
            border: 1px solid #e8ecff;
            border-radius: 12px;
            padding: 12px;
            margin: 10px 0;
        }
        
        .comment-author {
            color: #6B73FF;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .comment-text {
            color: #333;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .activity-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .emotion-selector {
                flex-wrap: wrap;
            }
        }
        
        /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            
            .header {
                background: none;
                color: #333;
                border-bottom: 2px solid #333;
            }
            
            .header h1, .subtitle {
                color: #333;
            }
            
            .progress-bar, .action-buttons, .control-buttons {
                display: none;
            }
            
            .section-card {
                page-break-inside: avoid;
                border: 1px solid #ddd;
            }
            
            .reflection-card {
                page-break-before: always;
                border: 2px solid #333;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ìš°ë¦¬ ë°˜ ë””ì§€í„¸ íƒí—˜ì¼ê¸°</h1>
            <div class="subtitle">ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ëŒì•„ë³´ë©° ë‚˜ë§Œì˜ ì´ì•¼ê¸° ì“°ê¸°</div>
            <div style="margin-top: 15px;">
                <button onclick="resetForm()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: 600;">
                    ğŸ”„ ë‹¤ì‹œ ì‘ì„±í•˜ê¸°
                </button>
                <button onclick="loadPrevious()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: 600; margin-left: 10px;">
                    ğŸ“‚ ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
                <button onclick="showHistory()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: 600; margin-left: 10px;">
                    ğŸ“š ê¸°ë¡ ëª¨ì•„ë³´ê¸°
                </button>
            </div>
        </div>
        
        <div class="content">
            <!-- ì§„í–‰ë„ í‘œì‹œ -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
            </div>
            
            <!-- 1ë‹¨ê³„: ì´ë¦„ -->
            <div class="name-section">
                <h3 style="color: #5D5FEF; margin-bottom: 10px;">ğŸ“› ë‚˜ëŠ” ëˆ„êµ¬?</h3>
                <input type="text" 
                       id="studentName" 
                       class="name-input" 
                       placeholder="ì´ë¦„ ë˜ëŠ” ë³„ëª…"
                       onchange="updateProgress()">
                <p style="color: #999; font-size: 0.9em; margin-top: 10px;">
                    1ì°¨ì‹œ: ë‚˜ì˜ ë””ì§€í„¸ ìŠµê´€ ì•Œì•„ë³´ê¸°
                </p>
            </div>
            
            <!-- 2ë‹¨ê³„: ì˜¤ëŠ˜ ì‚¬ìš©í•œ ê²ƒë“¤ (ë‹¤ì¤‘ì„ íƒ) -->
            <div class="section-card">
                <h2 class="section-title">ğŸ¯ ì˜¤ëŠ˜ ì‚¬ìš©í•œ ë””ì§€í„¸ ê¸°ê¸°ë‚˜ ì•± (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)</h2>
                
                <div class="activity-grid">
                    <div class="activity-item" onclick="toggleActivity(this, 'smartphone')">
                        <input type="checkbox" id="check-smartphone">
                        <label for="check-smartphone">ğŸ“± ìŠ¤ë§ˆíŠ¸í°</label>
                    </div>
                    <div class="activity-item" onclick="toggleActivity(this, 'youtube')">
                        <input type="checkbox" id="check-youtube">
                        <label for="check-youtube">ğŸ“º ìœ íŠœë¸Œ</label>
                    </div>
                    <div class="activity-item" onclick="toggleActivity(this, 'game')">
                        <input type="checkbox" id="check-game">
                        <label for="check-game">ğŸ® ê²Œì„</label>
                    </div>
                    <div class="activity-item" onclick="toggleActivity(this, 'sns')">
                        <input type="checkbox" id="check-sns">
                        <label for="check-sns">ğŸ’¬ SNS/ì±„íŒ…</label>
                    </div>
                    <div class="activity-item" onclick="toggleActivity(this, 'study')">
                        <input type="checkbox" id="check-study">
                        <label for="check-study">ğŸ“š í•™ìŠµì•±</label>
                    </div>
                    <div class="activity-item" onclick="toggleActivity(this, 'tv')">
                        <input type="checkbox" id="check-tv">
                        <label for="check-tv">ğŸ“º TV</label>
                    </div>
                    <div class="activity-item" onclick="toggleActivity(this, 'tablet')">
                        <input type="checkbox" id="check-tablet">
                        <label for="check-tablet">ğŸ“± íƒœë¸”ë¦¿</label>
                    </div>
                    <div class="activity-item" onclick="toggleActivity(this, 'computer')">
                        <input type="checkbox" id="check-computer">
                        <label for="check-computer">ğŸ’» ì»´í“¨í„°</label>
                    </div>
                </div>
                
                <div class="hint-bubble">
                    ğŸ’¡ ì˜¤ëŠ˜ ì‚¬ìš©í•œ ê²ƒì„ ëª¨ë‘ ì²´í¬í•´ë³´ì„¸ìš”! ì •ì§í•˜ê²Œ ì²´í¬í•˜ë©´ ë” ì¢‹ì€ ì„±ì°°ì´ ë¼ìš”.
                </div>
            </div>
            
            <!-- 3ë‹¨ê³„: ì‚¬ìš© ì‹œê°„ -->
            <div class="section-card">
                <h2 class="section-title">â° ì˜¤ëŠ˜ ë””ì§€í„¸ ê¸°ê¸°ë¥¼ ì–¼ë§ˆë‚˜ ì‚¬ìš©í–ˆë‚˜ìš”?</h2>
                
                <div class="time-tracker">
                    <div class="time-display" id="timeDisplay">2ì‹œê°„</div>
                    <input type="range" 
                           class="time-input" 
                           id="timeSlider" 
                           min="0" 
                           max="480" 
                           value="120" 
                           step="30"
                           oninput="updateTime(this.value)">
                    <div style="display: flex; justify-content: space-between; color: #999; font-size: 0.9em;">
                        <span>0ì‹œê°„</span>
                        <span>4ì‹œê°„</span>
                        <span>8ì‹œê°„</span>
                    </div>
                </div>
            </div>
            
            <!-- 4ë‹¨ê³„: ê°ì • ì„ íƒ -->
            <div class="section-card">
                <h2 class="section-title">ğŸ˜Š ë””ì§€í„¸ ê¸°ê¸°ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì–´ë–¤ ê¸°ë¶„ì´ì—ˆë‚˜ìš”?</h2>
                
                <div class="emotion-selector">
                    <button class="emotion-btn" onclick="selectEmotion(this, 'happy')" title="ì¦ê±°ì› ì–´ìš”">ğŸ˜„</button>
                    <button class="emotion-btn" onclick="selectEmotion(this, 'excited')" title="ì‹ ë‚¬ì–´ìš”">ğŸ¤—</button>
                    <button class="emotion-btn" onclick="selectEmotion(this, 'normal')" title="ê·¸ì € ê·¸ë¬ì–´ìš”">ğŸ˜</button>
                    <button class="emotion-btn" onclick="selectEmotion(this, 'tired')" title="í”¼ê³¤í–ˆì–´ìš”">ğŸ˜´</button>
                    <button class="emotion-btn" onclick="selectEmotion(this, 'regret')" title="í›„íšŒë¼ìš”">ğŸ˜”</button>
                    <button class="emotion-btn" onclick="selectEmotion(this, 'angry')" title="ì§œì¦ë‚¬ì–´ìš”">ğŸ˜¤</button>
                </div>
                
                <div class="text-area-wrapper">
                    <label class="text-area-label">ì™œ ê·¸ëŸ° ê¸°ë¶„ì´ì—ˆëŠ”ì§€ ì ì–´ë³´ì„¸ìš”:</label>
                    <textarea class="text-area" 
                              id="emotionReason" 
                              placeholder="ì˜ˆ: ì¹œêµ¬ë“¤ê³¼ ê°™ì´ ê²Œì„í•´ì„œ ì¦ê±°ì› ì–´ìš” / ë„ˆë¬´ ì˜¤ë˜í•´ì„œ ëˆˆì´ ì•„íŒ ì–´ìš”..."
                              onchange="updateProgress()"></textarea>
                </div>
            </div>
            
            <!-- 5ë‹¨ê³„: ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒ (ì„œìˆ í˜•) -->
            <div class="section-card">
                <h2 class="section-title">âœ¨ ì˜¤ëŠ˜ ë””ì§€í„¸ ê¸°ê¸°ë¡œ í•œ ê²ƒ ì¤‘ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒ</h2>
                
                <div class="text-area-wrapper">
                    <textarea class="text-area" 
                              id="memorable" 
                              placeholder="ë¬´ì—‡ì„ í–ˆëŠ”ì§€, ì™œ ê¸°ì–µì— ë‚¨ëŠ”ì§€ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”..."
                              onchange="updateProgress()"></textarea>
                    
                    <div class="writing-helper">
                        <button class="helper-btn" onclick="addHelper('memorable', 'ì¹œêµ¬ì™€ ')">ì¹œêµ¬ì™€</button>
                        <button class="helper-btn" onclick="addHelper('memorable', 'ìƒˆë¡œìš´ ')">ìƒˆë¡œìš´</button>
                        <button class="helper-btn" onclick="addHelper('memorable', 'ì²˜ìŒìœ¼ë¡œ ')">ì²˜ìŒìœ¼ë¡œ</button>
                        <button class="helper-btn" onclick="addHelper('memorable', 'ì¬ë¯¸ìˆëŠ” ')">ì¬ë¯¸ìˆëŠ”</button>
                        <button class="helper-btn" onclick="addHelper('memorable', 'ë„ì›€ì´ ëœ ')">ë„ì›€ì´ ëœ</button>
                    </div>
                </div>
            </div>
            
            <!-- 6ë‹¨ê³„: ì¢‹ì•˜ë˜ ì ê³¼ ì•„ì‰¬ìš´ ì  -->
            <div class="section-card">
                <h2 class="section-title">ğŸ’­ ì˜¤ëŠ˜ì˜ ë””ì§€í„¸ ìƒí™œ ëŒì•„ë³´ê¸°</h2>
                
                <div class="text-area-wrapper">
                    <label class="text-area-label">ğŸ‘ ì˜í•œ ì ì´ë‚˜ ì¢‹ì•˜ë˜ ì :</label>
                    <textarea class="text-area" 
                              id="goodPoints" 
                              placeholder="ì˜ˆ: ìˆ™ì œë¥¼ ë¨¼ì € í•˜ê³  ê²Œì„ì„ í–ˆì–´ìš” / ë™ìƒê³¼ í•¨ê»˜ ë´¤ì–´ìš”..."
                              onchange="updateProgress()"></textarea>
                </div>
                
                <div class="text-area-wrapper">
                    <label class="text-area-label">ğŸ¤” ì•„ì‰¬ìš´ ì ì´ë‚˜ ê³ ì¹˜ê³  ì‹¶ì€ ì :</label>
                    <textarea class="text-area" 
                              id="improvePoints" 
                              placeholder="ì˜ˆ: ì•½ì†í•œ ì‹œê°„ë³´ë‹¤ ë” ì˜¤ë˜ í–ˆì–´ìš” / ë°–ì—ì„œ ë†€ ì‹œê°„ì´ ì—†ì—ˆì–´ìš”..."
                              onchange="updateProgress()"></textarea>
                </div>
            </div>
            
            <!-- 7ë‹¨ê³„: ë‚´ì¼ì˜ ê³„íš -->
            <div class="section-card">
                <h2 class="section-title">ğŸ¯ ë‚´ì¼ì€ ì–´ë–»ê²Œ í•˜ê³  ì‹¶ë‚˜ìš”?</h2>
                
                <div class="text-area-wrapper">
                    <label class="text-area-label">ë‚´ì¼ì˜ ë‚˜ì™€ ì•½ì†:</label>
                    <textarea class="text-area" 
                              id="tomorrowPlan" 
                              placeholder="ì˜ˆ: ë‚´ì¼ì€ 1ì‹œê°„ë§Œ ì‚¬ìš©í•˜ê¸° / ì±… ì½ëŠ” ì‹œê°„ ë§Œë“¤ê¸° / ì¹œêµ¬ì™€ ë°–ì—ì„œ ë†€ê¸°..."
                              onchange="updateProgress()"></textarea>
                    
                    <div class="writing-helper">
                        <button class="helper-btn" onclick="addHelper('tomorrowPlan', 'ì‹œê°„ì„ ì •í•´ì„œ ')">ì‹œê°„ ì •í•˜ê¸°</button>
                        <button class="helper-btn" onclick="addHelper('tomorrowPlan', 'ë‹¤ë¥¸ í™œë™ë„ ')">ë‹¤ë¥¸ í™œë™</button>
                        <button class="helper-btn" onclick="addHelper('tomorrowPlan', 'ê°€ì¡±ê³¼ í•¨ê»˜ ')">ê°€ì¡±ê³¼</button>
                        <button class="helper-btn" onclick="addHelper('tomorrowPlan', 'ë°–ì—ì„œ ')">ë°–ì—ì„œ</button>
                        <button class="helper-btn" onclick="addHelper('tomorrowPlan', 'ì±…ì„ ')">ì±… ì½ê¸°</button>
                    </div>
                </div>
            </div>
            
            <!-- 8ë‹¨ê³„: ì¹œêµ¬ì™€ ê³µìœ  (ì„ íƒ) -->
            <div class="share-section">
                <h2 style="color: #ff6b6b; margin-bottom: 15px;">ğŸ¤ ì¹œêµ¬ë“¤ê³¼ ìƒê° ë‚˜ëˆ„ê¸° (ì„ íƒ)</h2>
                
                <div class="text-area-wrapper">
                    <label class="text-area-label">ì¹œêµ¬ë“¤ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§:</label>
                    <textarea class="text-area" 
                              id="shareMessage" 
                              placeholder="ì˜ˆ: ê°™ì´ ì‹œê°„ì„ ì •í•´ì„œ ì‚¬ìš©í•´ìš”! / ì¬ë¯¸ìˆëŠ” ì•±ì„ ì†Œê°œí•´ìš”..."
                              style="min-height: 60px;"></textarea>
                </div>
                
                <div class="friend-comments">
                    <h3 style="color: #666; font-size: 0.95em; margin: 15px 0;">ğŸ“¬ ì¹œêµ¬ë“¤ì˜ ìƒê°:</h3>
                    <div id="commentsContainer">
                        <!-- ì¹œêµ¬ ì½”ë©˜íŠ¸ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
            
            <!-- ë‚˜ì˜ ì„±ì°° ì¹´ë“œ -->
            <div class="reflection-card">
                <h2 class="reflection-title">ğŸ“‹ ì˜¤ëŠ˜ì˜ ë””ì§€í„¸ íƒí—˜ ì¼ê¸°</h2>
                
                <div class="reflection-content">
                    <div class="reflection-item">
                        <div class="reflection-label">íƒí—˜ê°€ ì´ë¦„</div>
                        <div class="reflection-text" id="refName">-</div>
                    </div>
                    
                    <div class="reflection-item">
                        <div class="reflection-label">ì˜¤ëŠ˜ ì‚¬ìš©í•œ ê²ƒë“¤</div>
                        <div class="reflection-text" id="refActivities">-</div>
                    </div>
                    
                    <div class="reflection-item">
                        <div class="reflection-label">ì‚¬ìš© ì‹œê°„</div>
                        <div class="reflection-text" id="refTime">-</div>
                    </div>
                    
                    <div class="reflection-item">
                        <div class="reflection-label">ì˜¤ëŠ˜ì˜ ê¸°ë¶„</div>
                        <div class="reflection-text" id="refEmotion">-</div>
                    </div>
                    
                    <div class="reflection-item">
                        <div class="reflection-label">ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒ</div>
                        <div class="reflection-text" id="refMemorable">-</div>
                    </div>
                    
                    <div class="reflection-item">
                        <div class="reflection-label">ì˜í•œ ì </div>
                        <div class="reflection-text" id="refGood">-</div>
                    </div>
                    
                    <div class="reflection-item">
                        <div class="reflection-label">ë‚´ì¼ì˜ ì•½ì†</div>
                        <div class="reflection-text" id="refTomorrow">-</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="secondary-btn" onclick="saveReflection()">ğŸ’¾ ë¸Œë¼ìš°ì €ì— ì €ì¥</button>
                    <button class="primary-btn" onclick="printReflection()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
                    <button class="secondary-btn" onclick="resetForm()">ğŸ”„ ë‹¤ì‹œ ì‘ì„±í•˜ê¸°</button>
                </div>
            </div>
            
            <!-- ì´ë¯¸ì§€ ì €ì¥ ì˜µì…˜ -->
            <div class="section-card" style="background: linear-gradient(135deg, #fff8f0, #fff); border-color: #ffe8d0;">
                <h2 class="section-title" style="color: #ff6b6b;">
                    <span>ğŸ“¸</span>
                    <span>íƒí—˜ì¼ì§€ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°</span>
                </h2>
                
                <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                    <!-- êµì‚¬ìš© -->
                    <div style="background: #f0f8ff; padding: 20px; border-radius: 15px; border: 2px solid #4a90e2;">
                        <h3 style="color: #4a90e2; margin-bottom: 10px;">ğŸ‘©â€ğŸ« êµì‚¬ìš© (ì „ì²´ í•™ìŠµì§€)</h3>
                        <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                            í•™ìƒì´ ì‘ì„±í•œ ëª¨ë“  ë‚´ìš©ì„ ìƒì„¸íˆ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì „ì²´ í™”ë©´ ì´ë¯¸ì§€
                        </p>
                        <button class="primary-btn" onclick="downloadTeacherVersion()" style="background: #4a90e2; width: 100%;">
                            ğŸ“Š ì „ì²´ í•™ìŠµì§€ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                    
                    <!-- í•™ìƒìš© -->
                    <div style="background: #fff0f5; padding: 20px; border-radius: 15px; border: 2px solid #ff69b4;">
                        <h3 style="color: #ff69b4; margin-bottom: 10px;">ğŸ’ í•™ìƒìš© (ì„±ì°° ì¹´ë“œ)</h3>
                        <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                            ì˜¤ëŠ˜ì˜ ë””ì§€í„¸ ìƒí™œì„ ì •ë¦¬í•œ ì˜ˆìœ ì¹´ë“œ (ì¹œêµ¬ë“¤ê³¼ ê³µìœ  ê°€ëŠ¥)
                        </p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <button class="secondary-btn" onclick="downloadStudentCard('simple')" style="background: #ff69b4; color: white;">
                                ğŸ’³ ì‹¬í”Œ ì¹´ë“œ
                            </button>
                            <button class="secondary-btn" onclick="downloadStudentCard('colorful')" style="background: #ff69b4; color: white;">
                                ğŸ¨ ì»¬ëŸ¬í’€ ì¹´ë“œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ì¶”ê°€ ì˜µì…˜ -->
                    <div style="background: #f0fff4; padding: 15px; border-radius: 15px; border: 2px solid #4CAF50;">
                        <button class="secondary-btn" onclick="downloadCertificate()" style="width: 100%; background: #4CAF50; color: white;">
                            ğŸ† ìˆ˜ë£Œì¦ ë°›ê¸° (ì§„í–‰ë¥  80% ì´ìƒ)
                        </button>
                    </div>
                </div>
                
                <div class="hint-bubble" style="margin-top: 15px;">
                    ğŸ’¡ ì´ë¯¸ì§€ë¡œ ì €ì¥í•œ í›„ í´ë˜ìŠ¤íŒ…, êµ¬ê¸€ í´ë˜ìŠ¤ë£¸, ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì œì¶œí•˜ì„¸ìš”!
                </div>
            </div>
            
            <!-- ì™„ë£Œ ë²„íŠ¼ -->
            <div class="action-buttons">
                <button class="primary-btn" onclick="completeReflection()" style="padding: 15px 40px; font-size: 1.1em;">
                    âœ¨ ì˜¤ëŠ˜ì˜ íƒí—˜ì¼ê¸° ì™„ì„±!
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let selectedActivities = new Set();
        let selectedEmotion = '';
        let currentProgress = 0;
        
        // í™œë™ í† ê¸€
        function toggleActivity(element, type) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                element.classList.add('checked');
                selectedActivities.add(type);
            } else {
                element.classList.remove('checked');
                selectedActivities.delete(type);
            }
            
            updateProgress();
            updateReflectionCard();
        }
        
        // ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime(value) {
            const hours = Math.floor(value / 60);
            const minutes = value % 60;
            let display = '';
            
            if (hours > 0) {
                display = hours + 'ì‹œê°„';
                if (minutes > 0) display += ' ' + minutes + 'ë¶„';
            } else {
                display = minutes + 'ë¶„';
            }
            
            document.getElementById('timeDisplay').textContent = display;
            
            // ì‹œê°„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            const timeDisplay = document.getElementById('timeDisplay');
            if (value <= 120) {
                timeDisplay.style.color = '#4ECDC4';
            } else if (value <= 240) {
                timeDisplay.style.color = '#ffa500';
            } else {
                timeDisplay.style.color = '#ff6b6b';
            }
            
            updateProgress();
            updateReflectionCard();
        }
        
        // ê°ì • ì„ íƒ
        function selectEmotion(btn, emotion) {
            document.querySelectorAll('.emotion-btn').forEach(b => {
                b.classList.remove('selected');
            });
            btn.classList.add('selected');
            selectedEmotion = emotion;
            updateProgress();
            updateReflectionCard();
        }
        
        // ë„ìš°ë¯¸ í…ìŠ¤íŠ¸ ì¶”ê°€
        function addHelper(textareaId, text) {
            const textarea = document.getElementById(textareaId);
            textarea.value += text;
            textarea.focus();
        }
        
        // ì§„í–‰ë„ ì—…ë°ì´íŠ¸
        function updateProgress() {
            let completed = 0;
            const total = 8;
            
            if (document.getElementById('studentName').value) completed++;
            if (selectedActivities.size > 0) completed++;
            if (document.getElementById('timeSlider').value) completed++;
            if (selectedEmotion) completed++;
            if (document.getElementById('emotionReason').value) completed++;
            if (document.getElementById('memorable').value) completed++;
            if (document.getElementById('goodPoints').value || document.getElementById('improvePoints').value) completed++;
            if (document.getElementById('tomorrowPlan').value) completed++;
            
            currentProgress = Math.round((completed / total) * 100);
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = currentProgress + '%';
            progressBar.textContent = currentProgress + '%';
            
            updateReflectionCard();
        }
        
        // ì„±ì°° ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateReflectionCard() {
            const name = document.getElementById('studentName').value || 'íƒí—˜ê°€';
            const activities = Array.from(selectedActivities).map(a => {
                const icons = {
                    'smartphone': 'ğŸ“± ìŠ¤ë§ˆíŠ¸í°',
                    'youtube': 'ğŸ“º ìœ íŠœë¸Œ',
                    'game': 'ğŸ® ê²Œì„',
                    'sns': 'ğŸ’¬ SNS',
                    'study': 'ğŸ“š í•™ìŠµì•±',
                    'tv': 'ğŸ“º TV',
                    'tablet': 'ğŸ“± íƒœë¸”ë¦¿',
                    'computer': 'ğŸ’» ì»´í“¨í„°'
                };
                return icons[a] || a;
            }).join(', ') || 'ì•„ì§ ì„ íƒ ì•ˆ í•¨';
            
            const time = document.getElementById('timeDisplay').textContent;
            
            const emotionTexts = {
                'happy': 'ğŸ˜„ ì¦ê±°ì› ì–´ìš”',
                'excited': 'ğŸ¤— ì‹ ë‚¬ì–´ìš”',
                'normal': 'ğŸ˜ ê·¸ì € ê·¸ë¬ì–´ìš”',
                'tired': 'ğŸ˜´ í”¼ê³¤í–ˆì–´ìš”',
                'regret': 'ğŸ˜” í›„íšŒë¼ìš”',
                'angry': 'ğŸ˜¤ ì§œì¦ë‚¬ì–´ìš”'
            };
            const emotionReason = document.getElementById('emotionReason').value;
            const emotion = selectedEmotion ? 
                (emotionTexts[selectedEmotion] + (emotionReason ? ': ' + emotionReason : '')) : 
                'ì•„ì§ ì„ íƒ ì•ˆ í•¨';
            
            const memorable = document.getElementById('memorable').value || 'ì•„ì§ ì‘ì„± ì•ˆ í•¨';
            const good = document.getElementById('goodPoints').value || 'ì•„ì§ ì‘ì„± ì•ˆ í•¨';
            const tomorrow = document.getElementById('tomorrowPlan').value || 'ì•„ì§ ì‘ì„± ì•ˆ í•¨';
            
            document.getElementById('refName').textContent = name;
            document.getElementById('refActivities').textContent = activities;
            document.getElementById('refTime').textContent = time;
            document.getElementById('refEmotion').textContent = emotion;
            document.getElementById('refMemorable').textContent = memorable;
            document.getElementById('refGood').textContent = good;
            document.getElementById('refTomorrow').textContent = tomorrow;
        }
        
        // ì €ì¥í•˜ê¸°
        function saveReflection() {
            const data = {
                name: document.getElementById('studentName').value,
                activities: Array.from(selectedActivities),
                time: document.getElementById('timeSlider').value,
                emotion: selectedEmotion,
                emotionReason: document.getElementById('emotionReason').value,
                memorable: document.getElementById('memorable').value,
                goodPoints: document.getElementById('goodPoints').value,
                improvePoints: document.getElementById('improvePoints').value,
                tomorrowPlan: document.getElementById('tomorrowPlan').value,
                shareMessage: document.getElementById('shareMessage').value,
                date: new Date().toLocaleDateString('ko-KR'),
                progress: currentProgress
            };
            
            // ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
            const history = JSON.parse(localStorage.getItem('reflectionHistory') || '[]');
            history.push(data);
            localStorage.setItem('reflectionHistory', JSON.stringify(history));
            localStorage.setItem('lastReflection', JSON.stringify(data));
            
            alert('âœ… ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë‚˜ì¤‘ì— ë‹¤ì‹œ ë³¼ ìˆ˜ ìˆì–´ìš”.\n(ë‹¤ë¥¸ ê¸°ê¸°ë‚˜ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤)');
        }
        
        // ì¸ì‡„í•˜ê¸° (downloadAsImage í•¨ìˆ˜ëŠ” ì œê±°)
        function printReflection() {
            updateReflectionCard();
            window.print();
        }
        
        // ë‹¤ì‹œ ì‘ì„±í•˜ê¸°
        function resetForm() {
            if (!confirm('ì •ë§ ë‹¤ì‹œ ì‘ì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‘ì„±í•œ ë‚´ìš©ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
                return;
            }
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('studentName').value = '';
            document.getElementById('timeSlider').value = 120;
            document.getElementById('emotionReason').value = '';
            document.getElementById('memorable').value = '';
            document.getElementById('goodPoints').value = '';
            document.getElementById('improvePoints').value = '';
            document.getElementById('tomorrowPlan').value = '';
            document.getElementById('shareMessage').value = '';
            
            // í™œë™ ì²´í¬ ì´ˆê¸°í™”
            selectedActivities.clear();
            document.querySelectorAll('.activity-item').forEach(item => {
                item.classList.remove('checked');
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox) checkbox.checked = false;
            });
            
            // ê°ì • ì´ˆê¸°í™”
            selectedEmotion = '';
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ì‹œê°„ ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™”
            updateTime(120);
            
            // ì§„í–‰ë¥  ì´ˆê¸°í™”
            currentProgress = 0;
            updateProgress();
            
            // ìŠ¤í¬ë¡¤ ìµœìƒë‹¨ìœ¼ë¡œ
            window.scrollTo(0, 0);
            
            alert('âœ¨ ìƒˆë¡œìš´ íƒí—˜ì¼ì§€ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!');
        }
        
        // êµì‚¬ìš©: ì „ì²´ í•™ìŠµì§€ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        function downloadTeacherVersion() {
            updateReflectionCard();
            
            // ë¡œë”© í‘œì‹œ
            const originalBtn = event.target;
            const originalText = originalBtn.innerHTML;
            originalBtn.innerHTML = 'â³ ìƒì„±ì¤‘...';
            originalBtn.disabled = true;
            
            // ì„ì‹œ ì»¨í…Œì´ë„ˆ ìƒì„±
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'fixed';
            tempContainer.style.left = '-9999px';
            tempContainer.style.width = '1000px';
            tempContainer.style.background = 'white';
            tempContainer.style.padding = '40px';
            tempContainer.style.fontFamily = 'Noto Sans KR, sans-serif';
            document.body.appendChild(tempContainer);
            
            const studentName = document.getElementById('studentName').value || 'ë¯¸ì…ë ¥';
            const date = new Date().toLocaleDateString('ko-KR');
            const timeValue = document.getElementById('timeSlider').value;
            const hours = Math.floor(timeValue / 60);
            const minutes = timeValue % 60;
            const timeText = hours > 0 ? `${hours}ì‹œê°„ ${minutes}ë¶„` : `${minutes}ë¶„`;
            
            // í™œë™ ëª©ë¡ ìƒì„±
            const activities = Array.from(selectedActivities).map(a => {
                const icons = {
                    'smartphone': 'ğŸ“± ìŠ¤ë§ˆíŠ¸í°',
                    'youtube': 'ğŸ“º ìœ íŠœë¸Œ',
                    'game': 'ğŸ® ê²Œì„',
                    'sns': 'ğŸ’¬ SNS/ì±„íŒ…',
                    'study': 'ğŸ“š í•™ìŠµì•±',
                    'tv': 'ğŸ“º TV',
                    'tablet': 'ğŸ“± íƒœë¸”ë¦¿',
                    'computer': 'ğŸ’» ì»´í“¨í„°'
                };
                return icons[a] || a;
            }).join(', ') || 'ì„ íƒ ì—†ìŒ';
            
            // ê°ì • í…ìŠ¤íŠ¸
            const emotionTexts = {
                'happy': 'ğŸ˜„ ì¦ê±°ì› ì–´ìš”',
                'excited': 'ğŸ¤— ì‹ ë‚¬ì–´ìš”',
                'normal': 'ğŸ˜ ê·¸ì € ê·¸ë¬ì–´ìš”',
                'tired': 'ğŸ˜´ í”¼ê³¤í–ˆì–´ìš”',
                'regret': 'ğŸ˜” í›„íšŒë¼ìš”',
                'angry': 'ğŸ˜¤ ì§œì¦ë‚¬ì–´ìš”'
            };
            
            // ì „ì²´ í•™ìŠµì§€ HTML ìƒì„±
            tempContainer.innerHTML = `
                <div style="border: 3px solid #4a90e2; border-radius: 20px; padding: 30px;">
                    <!-- í—¤ë” -->
                    <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e8ecff;">
                        <h1 style="color: #4a90e2; font-size: 2em; margin-bottom: 10px;">ğŸ“Š ë””ì§€í„¸ íƒí—˜ì¼ì§€ - êµì‚¬ í™•ì¸ìš©</h1>
                        <div style="color: #666; font-size: 1.1em;">
                            <span style="font-weight: bold;">í•™ìƒ: ${studentName}</span> | 
                            <span>ì‘ì„±ì¼: ${date}</span> | 
                            <span>ì§„í–‰ë¥ : ${currentProgress}%</span>
                        </div>
                    </div>
                    
                    <!-- 1. ê¸°ë³¸ ì •ë³´ -->
                    <div style="background: #f8f9ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="color: #5D5FEF; margin-bottom: 15px;">ğŸ“Œ ê¸°ë³¸ ì •ë³´</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div><strong>í•™ìƒ ì´ë¦„:</strong> ${studentName}</div>
                            <div><strong>ì‚¬ìš© ì‹œê°„:</strong> ${timeText}</div>
                            <div style="grid-column: 1 / -1;"><strong>ì‚¬ìš©í•œ ê¸°ê¸°/ì•±:</strong> ${activities}</div>
                        </div>
                    </div>
                    
                    <!-- 2. ê°ì • ë° ì´ìœ  -->
                    <div style="background: #fff8f0; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="color: #ff6b6b; margin-bottom: 15px;">ğŸ˜Š ê°ì • ê¸°ë¡</h3>
                        <div><strong>ì˜¤ëŠ˜ì˜ ê¸°ë¶„:</strong> ${emotionTexts[selectedEmotion] || 'ë¯¸ì„ íƒ'}</div>
                        <div style="margin-top: 10px;">
                            <strong>ì´ìœ :</strong>
                            <div style="background: white; padding: 10px; border-radius: 8px; margin-top: 5px; min-height: 40px;">
                                ${document.getElementById('emotionReason').value || 'ì‘ì„±í•˜ì§€ ì•ŠìŒ'}
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3. ì„œìˆ í˜• ì‘ë‹µë“¤ -->
                    <div style="background: #f0fff4; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="color: #4CAF50; margin-bottom: 15px;">âœï¸ ìƒì„¸ ê¸°ë¡</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>ğŸ“Œ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒ:</strong>
                            <div style="background: white; padding: 10px; border-radius: 8px; margin-top: 5px; min-height: 40px;">
                                ${document.getElementById('memorable').value || 'ì‘ì„±í•˜ì§€ ì•ŠìŒ'}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>ğŸ‘ ì˜í•œ ì :</strong>
                            <div style="background: white; padding: 10px; border-radius: 8px; margin-top: 5px; min-height: 40px;">
                                ${document.getElementById('goodPoints').value || 'ì‘ì„±í•˜ì§€ ì•ŠìŒ'}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>ğŸ¤” ì•„ì‰¬ìš´ ì :</strong>
                            <div style="background: white; padding: 10px; border-radius: 8px; margin-top: 5px; min-height: 40px;">
                                ${document.getElementById('improvePoints').value || 'ì‘ì„±í•˜ì§€ ì•ŠìŒ'}
                            </div>
                        </div>
                        
                        <div>
                            <strong>ğŸ¯ ë‚´ì¼ì˜ ê³„íš:</strong>
                            <div style="background: white; padding: 10px; border-radius: 8px; margin-top: 5px; min-height: 40px;">
                                ${document.getElementById('tomorrowPlan').value || 'ì‘ì„±í•˜ì§€ ì•ŠìŒ'}
                            </div>
                        </div>
                    </div>
                    
                    <!-- 4. í‰ê°€ ë©”ëª¨ ê³µê°„ -->
                    <div style="background: #fffbf0; padding: 20px; border-radius: 12px; border: 2px dashed #ffd93d;">
                        <h3 style="color: #f39c12; margin-bottom: 10px;">ğŸ“ êµì‚¬ ë©”ëª¨ë€</h3>
                        <div style="height: 60px; background: white; border: 1px solid #ddd; border-radius: 8px;"></div>
                    </div>
                    
                    <!-- í‘¸í„° -->
                    <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #e8ecff;">
                        <small style="color: #999;">
                            ìƒì„± ì‹œê°: ${new Date().toLocaleString('ko-KR')} | 
                            ë””ì§€í„¸ íƒí—˜ì¼ì§€ v1.0
                        </small>
                    </div>
                </div>
            `;
            
            // html2canvasë¡œ ìº¡ì²˜
            html2canvas(tempContainer, {
                scale: 2,
                backgroundColor: '#ffffff',
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                const fileName = `êµì‚¬ìš©_${studentName}_${new Date().toISOString().split('T')[0]}.png`;
                link.download = fileName;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                document.body.removeChild(tempContainer);
                originalBtn.innerHTML = originalText;
                originalBtn.disabled = false;
                
                alert('ğŸ“Š êµì‚¬ìš© ì „ì²´ í•™ìŠµì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(error => {
                console.error('ì˜¤ë¥˜:', error);
                if (tempContainer.parentNode) {
                    document.body.removeChild(tempContainer);
                }
                originalBtn.innerHTML = originalText;
                originalBtn.disabled = false;
            });
        }
        
        // í•™ìƒìš©: ì„±ì°° ì¹´ë“œ ì´ë¯¸ì§€
        function downloadStudentCard(style) {
            updateReflectionCard();
            
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'fixed';
            tempDiv.style.left = '-9999px';
            tempDiv.style.width = '500px';
            tempDiv.style.padding = '40px';
            document.body.appendChild(tempDiv);
            
            const studentName = document.getElementById('studentName').value || 'íƒí—˜ê°€';
            const date = new Date().toLocaleDateString('ko-KR');
            const timeValue = document.getElementById('timeSlider').value;
            const hours = Math.floor(timeValue / 60);
            const minutes = timeValue % 60;
            const timeText = hours > 0 ? `${hours}ì‹œê°„ ${minutes}ë¶„` : `${minutes}ë¶„`;
            
            if (style === 'simple') {
                // ì‹¬í”Œ ì¹´ë“œ
                tempDiv.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                tempDiv.innerHTML = `
                    <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        <h2 style="text-align: center; color: #667eea; margin-bottom: 20px; font-size: 1.5em;">
                            ğŸ’³ ë‚˜ì˜ ë””ì§€í„¸ í•˜ë£¨
                        </h2>
                        <div style="text-align: center; color: #999; margin-bottom: 20px;">
                            ${studentName} | ${date}
                        </div>
                        
                        <div style="background: #f8f9ff; padding: 15px; border-radius: 12px; margin: 15px 0;">
                            <div style="color: #667eea; font-weight: bold;">â± ì‚¬ìš© ì‹œê°„</div>
                            <div style="font-size: 1.2em; margin-top: 5px;">${timeText}</div>
                        </div>
                        
                        <div style="background: #fff8f0; padding: 15px; border-radius: 12px; margin: 15px 0;">
                            <div style="color: #ff6b6b; font-weight: bold;">âœ¨ ì˜¤ëŠ˜ì˜ ë°œê²¬</div>
                            <div style="margin-top: 5px;">${document.getElementById('memorable').value || 'ë©‹ì§„ í•˜ë£¨ì˜€ì–´ìš”!'}</div>
                        </div>
                        
                        <div style="background: #f0fff4; padding: 15px; border-radius: 12px; margin: 15px 0;">
                            <div style="color: #4CAF50; font-weight: bold;">ğŸ¯ ë‚´ì¼ì˜ ëª©í‘œ</div>
                            <div style="margin-top: 5px;">${document.getElementById('tomorrowPlan').value || 'ë” ë‚˜ì€ ë‚´ì¼ì„ ë§Œë“¤ì–´ìš”!'}</div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 2px solid #e8ecff;">
                            <div style="font-size: 1.5em;">ğŸ’ª</div>
                            <div style="color: #667eea; font-weight: bold;">ì˜¤ëŠ˜ë„ ì˜í–ˆì–´ìš”!</div>
                        </div>
                    </div>
                `;
            } else {
                // ì»¬ëŸ¬í’€ ì¹´ë“œ
                tempDiv.style.background = 'linear-gradient(135deg, #FF6B6B, #4ECDC4)';
                tempDiv.innerHTML = `
                    <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 3em;">ğŸŒˆ</div>
                            <h2 style="color: transparent; background: linear-gradient(135deg, #FF6B6B, #4ECDC4); -webkit-background-clip: text; background-clip: text; font-size: 1.8em;">
                                ë””ì§€í„¸ íƒí—˜ ì™„ë£Œ!
                            </h2>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #fff0f5, #f0fffe); padding: 20px; border-radius: 15px;">
                            <div style="text-align: center; color: #666; margin-bottom: 15px;">
                                <strong>${studentName}</strong>ì˜ ${date}
                            </div>
                            
                            <div style="display: flex; justify-content: space-around; text-align: center;">
                                <div>
                                    <div style="font-size: 2em;">â°</div>
                                    <div style="color: #FF6B6B; font-weight: bold;">${timeText}</div>
                                </div>
                                <div>
                                    <div style="font-size: 2em;">${document.querySelectorAll('.emotion-btn.selected')[0]?.textContent || 'ğŸ˜Š'}</div>
                                    <div style="color: #4ECDC4; font-weight: bold;">ì˜¤ëŠ˜ì˜ ê¸°ë¶„</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 10px;">
                                <div style="color: #FF6B6B; font-weight: bold; margin-bottom: 10px;">ğŸ’­ ì˜¤ëŠ˜ì˜ í•œë§ˆë””</div>
                                <div style="font-style: italic; color: #666;">
                                    "${document.getElementById('memorable').value || 'ì˜¤ëŠ˜ë„ ì—´ì‹¬íˆ íƒí—˜í–ˆì–´ìš”!'}"
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; text-align: center;">
                                <span style="display: inline-block; background: linear-gradient(135deg, #FF6B6B, #4ECDC4); color: white; padding: 8px 20px; border-radius: 20px; font-weight: bold;">
                                    ì§„í–‰ë¥  ${currentProgress}% ë‹¬ì„±! ğŸ‰
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html2canvas(tempDiv, {
                scale: 2,
                backgroundColor: null,
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                const styleText = style === 'simple' ? 'ì‹¬í”Œ' : 'ì»¬ëŸ¬í’€';
                const fileName = `í•™ìƒìš©_${styleText}_${studentName}_${new Date().toISOString().split('T')[0]}.png`;
                link.download = fileName;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                document.body.removeChild(tempDiv);
                alert(`ğŸ¨ ${styleText} ì¹´ë“œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì¹œêµ¬ë“¤ê³¼ ê³µìœ í•´ë³´ì„¸ìš”!`);
            });
        }
        
        // ê°„ë‹¨ ì¹´ë“œ (ê¸°ì¡´ í•¨ìˆ˜ ì œê±°)
        function downloadSimpleCard() {
            downloadStudentCard('simple');
        }
        
        // ìˆ˜ë£Œì¦ ìŠ¤íƒ€ì¼ ì´ë¯¸ì§€ ì €ì¥
        function downloadCertificate() {
            if (currentProgress < 80) {
                alert('ì§„í–‰ë¥ ì´ 80% ì´ìƒì´ì–´ì•¼ ìˆ˜ë£Œì¦ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”! ğŸ˜Š');
                return;
            }
            
            // ì„ì‹œ div ìƒì„±
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'fixed';
            tempDiv.style.left = '-9999px';
            tempDiv.style.width = '800px';
            tempDiv.style.height = '600px';
            tempDiv.style.padding = '40px';
            tempDiv.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
            tempDiv.style.display = 'flex';
            tempDiv.style.alignItems = 'center';
            tempDiv.style.justifyContent = 'center';
            document.body.appendChild(tempDiv);
            
            const studentName = document.getElementById('studentName').value || 'íƒí—˜ê°€';
            const timeValue = document.getElementById('timeSlider').value;
            const hours = Math.floor(timeValue / 60);
            const minutes = timeValue % 60;
            const timeText = hours > 0 ? `${hours}ì‹œê°„ ${minutes}ë¶„` : `${minutes}ë¶„`;
            
            // ìˆ˜ë£Œì¦ ë‚´ìš© ìƒì„±
            tempDiv.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 50px; width: 100%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                    <div style="font-size: 3em; margin-bottom: 20px;">ğŸ†</div>
                    <h1 style="color: #FFD700; font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">
                        ë””ì§€í„¸ íƒí—˜ ìˆ˜ë£Œì¦
                    </h1>
                    <div style="color: #666; font-size: 1.2em; margin-bottom: 30px;">Certificate of Digital Exploration</div>
                    
                    <div style="border-top: 2px solid #FFD700; border-bottom: 2px solid #FFD700; padding: 20px 0; margin: 30px 0;">
                        <h2 style="color: #333; font-size: 2em; margin-bottom: 10px;">${studentName}</h2>
                        <p style="color: #666; font-size: 1.1em;">ìœ„ íƒí—˜ê°€ëŠ” ì˜¤ëŠ˜ í•˜ë£¨ ë™ì•ˆ</p>
                        <p style="color: #FF6B6B; font-size: 1.3em; font-weight: bold; margin: 10px 0;">${timeText} ë™ì•ˆ ë””ì§€í„¸ ê¸°ê¸°ë¥¼ ì‚¬ìš©í•˜ë©°</p>
                        <p style="color: #666; font-size: 1.1em;">ìì‹ ì˜ ë””ì§€í„¸ ìƒí™œì„ ì„±ì‹¤íˆ ê¸°ë¡í•˜ê³  ì„±ì°°í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <p style="color: #4ECDC4; font-size: 1.2em; font-weight: bold;">ì§„í–‰ë¥ : ${currentProgress}%</p>
                        <p style="color: #999; font-size: 1em; margin-top: 10px;">${new Date().toLocaleDateString('ko-KR')}</p>
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; justify-content: space-around;">
                        <div>
                            <div style="font-size: 1.5em;">âœ¨</div>
                            <div style="color: #666; font-size: 0.9em;">ì„±ì‹¤í•¨</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5em;">ğŸ’­</div>
                            <div style="color: #666; font-size: 0.9em;">ì„±ì°°</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5em;">ğŸ¯</div>
                            <div style="color: #666; font-size: 0.9em;">ê³„íš</div>
                        </div>
                    </div>
                </div>
            `;
            
            html2canvas(tempDiv, {
                scale: 2,
                backgroundColor: null,
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                const date = new Date().toISOString().split('T')[0];
                link.download = `ë””ì§€í„¸íƒí—˜_ìˆ˜ë£Œì¦_${studentName}_${date}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                document.body.removeChild(tempDiv);
                
                alert('ğŸ† ìˆ˜ë£Œì¦ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì •ë§ ì˜í–ˆì–´ìš”!');
            });
        }
        
        // ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadPrevious() {
            const lastData = localStorage.getItem('lastReflection');
            if (!lastData) {
                alert('ğŸ’­ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm('ì´ì „ì— ì‘ì„±í•œ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¬ê¹Œìš”?')) {
                return;
            }
            
            const data = JSON.parse(lastData);
            
            // ë°ì´í„° ë³µì›
            document.getElementById('studentName').value = data.name || '';
            document.getElementById('timeSlider').value = data.time || 120;
            document.getElementById('emotionReason').value = data.emotionReason || '';
            document.getElementById('memorable').value = data.memorable || '';
            document.getElementById('goodPoints').value = data.goodPoints || '';
            document.getElementById('improvePoints').value = data.improvePoints || '';
            document.getElementById('tomorrowPlan').value = data.tomorrowPlan || '';
            document.getElementById('shareMessage').value = data.shareMessage || '';
            
            // í™œë™ ë³µì›
            selectedActivities.clear();
            data.activities?.forEach(activity => {
                selectedActivities.add(activity);
                const item = document.querySelector(`#check-${activity}`);
                if (item) {
                    item.checked = true;
                    item.parentElement.classList.add('checked');
                }
            });
            
            // ê°ì • ë³µì›
            if (data.emotion) {
                selectedEmotion = data.emotion;
                document.querySelectorAll('.emotion-btn').forEach(btn => {
                    if (btn.getAttribute('onclick').includes(data.emotion)) {
                        btn.classList.add('selected');
                    }
                });
            }
            
            updateTime(data.time || 120);
            updateProgress();
            
            alert(`âœ… ${data.date}ì— ì‘ì„±í•œ ë‚´ìš©ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!`);
        }
        
        // ì™„ë£Œ
        function completeReflection() {
            if (currentProgress < 80) {
                alert('ì•„ì§ ì‘ì„±í•˜ì§€ ì•Šì€ ë¶€ë¶„ì´ ìˆì–´ìš”! ì¡°ê¸ˆ ë” ì±„ì›Œì£¼ì„¸ìš”. ğŸ˜Š');
                return;
            }
            
            saveReflection();
            
            const message = `
ğŸŠ ì˜¤ëŠ˜ì˜ íƒí—˜ì¼ê¸° ì™„ì„±!

ì§„í–‰ë¥ : ${currentProgress}%
${currentProgress === 100 ? 'ì™„ë²½í•˜ê²Œ ì‘ì„±í–ˆë„¤ìš”! ğŸŒŸ' : 'ì˜ ì‘ì„±í–ˆì–´ìš”! ğŸ‘'}

ë‚´ì¼ë„ í•¨ê»˜ íƒí—˜í•´ìš”!
            `.trim();
            
            alert(message);
            
            // ì¹œêµ¬ ì½”ë©˜íŠ¸ ì˜ˆì‹œ ì¶”ê°€ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ê°€ì ¸ì˜´)
            addFriendComment('ë¯¼ìˆ˜', 'ë‚˜ë„ ì˜¤ëŠ˜ ê²Œì„ ë§ì´ í–ˆëŠ”ë° ë‚´ì¼ì€ ì¤„ì—¬ë³´ë ¤ê³ !');
            addFriendComment('ì§€ì˜', 'ê°™ì´ ë°–ì—ì„œ ë†€ì! ğŸ˜Š');
        }
        
        // ì¹œêµ¬ ì½”ë©˜íŠ¸ ì¶”ê°€
        function addFriendComment(author, text) {
            const container = document.getElementById('commentsContainer');
            const comment = document.createElement('div');
            comment.className = 'comment';
            comment.innerHTML = `
                <div class="comment-author">${author}</div>
                <div class="comment-text">${text}</div>
            `;
            container.appendChild(comment);
        }
        
        // ê¸°ë¡ ëª¨ì•„ë³´ê¸°
        function showHistory() {
            const history = JSON.parse(localStorage.getItem('reflectionHistory') || '[]');
            
            if (history.length === 0) {
                alert('ğŸ“­ ì•„ì§ ì €ì¥ëœ íƒí—˜ì¼ê¸°ê°€ ì—†ì–´ìš”.');
                return;
            }
            
            // ëª¨ë‹¬ ìƒì„±
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 30px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            `;
            
            let htmlContent = `
                <h2 style="color: #5D5FEF; margin-bottom: 20px;">ğŸ“š ë‚˜ì˜ íƒí—˜ì¼ê¸° ê¸°ë¡</h2>
                <button onclick="this.parentElement.parentElement.remove()" style="float: right; background: #ff6b6b; color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer;">âœ• ë‹«ê¸°</button>
                <div style="clear: both; margin-top: 20px;">
            `;
            
            // ìµœê·¼ ê¸°ë¡ë¶€í„° í‘œì‹œ (ì—­ìˆœ)
            history.reverse().slice(0, 10).forEach((record, index) => {
                const timeValue = record.time || 0;
                const hours = Math.floor(timeValue / 60);
                const minutes = timeValue % 60;
                const timeText = hours > 0 ? `${hours}ì‹œê°„ ${minutes}ë¶„` : `${minutes}ë¶„`;
                
                htmlContent += `
                    <div style="background: #f8f9ff; border-left: 3px solid #6B73FF; padding: 15px; margin: 15px 0; border-radius: 8px;">
                        <div style="color: #5D5FEF; font-weight: bold; margin-bottom: 10px;">
                            ğŸ“… ${record.date} | ${record.name || 'ìµëª…'} | ì§„í–‰ë¥ : ${record.progress || 0}%
                        </div>
                        <div style="color: #666; line-height: 1.5;">
                            â± ì‚¬ìš© ì‹œê°„: ${timeText}<br>
                            ğŸ“ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒ: ${record.memorable || 'ê¸°ë¡ ì—†ìŒ'}<br>
                            ğŸ¯ ë‚´ì¼ì˜ ì•½ì†: ${record.tomorrowPlan || 'ê¸°ë¡ ì—†ìŒ'}
                        </div>
                        <button onclick="loadHistoryItem(${history.length - 1 - index})" style="margin-top: 10px; background: #6B73FF; color: white; border: none; padding: 5px 15px; border-radius: 10px; cursor: pointer; font-size: 0.9em;">
                            ğŸ“‚ ì´ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
                        </button>
                    </div>
                `;
            });
            
            if (history.length > 10) {
                htmlContent += `<p style="text-align: center; color: #999; margin-top: 20px;">ìµœê·¼ 10ê°œì˜ ê¸°ë¡ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</p>`;
            }
            
            htmlContent += '</div>';
            modalContent.innerHTML = htmlContent;
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }
        
        // íŠ¹ì • ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadHistoryItem(index) {
            const history = JSON.parse(localStorage.getItem('reflectionHistory') || '[]');
            const data = history[index];
            
            if (!data) {
                alert('ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ëª¨ë‹¬ ë‹«ê¸°
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) modal.remove();
            
            // ë°ì´í„° ë³µì› (loadPreviousì™€ ë™ì¼í•œ ë¡œì§)
            document.getElementById('studentName').value = data.name || '';
            document.getElementById('timeSlider').value = data.time || 120;
            document.getElementById('emotionReason').value = data.emotionReason || '';
            document.getElementById('memorable').value = data.memorable || '';
            document.getElementById('goodPoints').value = data.goodPoints || '';
            document.getElementById('improvePoints').value = data.improvePoints || '';
            document.getElementById('tomorrowPlan').value = data.tomorrowPlan || '';
            document.getElementById('shareMessage').value = data.shareMessage || '';
            
            // í™œë™ ë³µì›
            selectedActivities.clear();
            document.querySelectorAll('.activity-item').forEach(item => {
                item.classList.remove('checked');
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox) checkbox.checked = false;
            });
            
            data.activities?.forEach(activity => {
                selectedActivities.add(activity);
                const item = document.querySelector(`#check-${activity}`);
                if (item) {
                    item.checked = true;
                    item.parentElement.classList.add('checked');
                }
            });
            
            // ê°ì • ë³µì›
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            if (data.emotion) {
                selectedEmotion = data.emotion;
                document.querySelectorAll('.emotion-btn').forEach(btn => {
                    if (btn.getAttribute('onclick').includes(data.emotion)) {
                        btn.classList.add('selected');
                    }
                });
            }
            
            updateTime(data.time || 120);
            updateProgress();
            
            alert(`âœ… ${data.date}ì˜ ê¸°ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!`);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ì „ ë°ì´í„° í™•ì¸
        window.onload = function() {
            const lastData = localStorage.getItem('lastReflection');
            if (lastData) {
                const data = JSON.parse(lastData);
                const today = new Date().toLocaleDateString('ko-KR');
                
                // ì˜¤ëŠ˜ ì‘ì„±í•œ ê²ƒì´ ì•„ë‹ˆë©´ ë¬¼ì–´ë³´ê¸°
                if (data.date !== today) {
                    setTimeout(() => {
                        if (confirm(`ğŸ“ ì´ì „ì— ì‘ì„±í•œ íƒí—˜ì¼ê¸°ê°€ ìˆì–´ìš”. (${data.date})\nì´ì–´ì„œ ì‘ì„±í• ê¹Œìš”?`)) {
                            loadPrevious();
                        }
                    }, 500);
                }
            }
        };
    </script>
</body>
</html>